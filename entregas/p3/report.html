<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>p3</title>
      <style>.markdown-preview, .markdown-preview[data-use-github-style] { font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 1.6; word-wrap: break-word; overflow: scroll; box-sizing: border-box; padding: 20px; background-color: rgb(255, 255, 255); }
.markdown-preview > :first-child, .markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview > :last-child, .markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview a:not([href]), .markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview .absent, .markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview .anchor, .markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview .anchor:focus, .markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1, .markdown-preview h2, .markdown-preview[data-use-github-style] h2, .markdown-preview h3, .markdown-preview[data-use-github-style] h3, .markdown-preview h4, .markdown-preview[data-use-github-style] h4, .markdown-preview h5, .markdown-preview[data-use-github-style] h5, .markdown-preview h6, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview h1 .octicon-link, .markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview h2 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview h3 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview h4 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview h5 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview h6 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview h1:hover .anchor, .markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview h2:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview h3:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview h4:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview h5:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview h6:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview h6:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview h1 tt, .markdown-preview[data-use-github-style] h1 tt, .markdown-preview h2 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview h3 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview h4 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview h5 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview h6 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview h1 code, .markdown-preview[data-use-github-style] h1 code, .markdown-preview h2 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview h3 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview h4 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview h5 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview h6 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview h1 .anchor, .markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview h2, .markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview h2 .anchor, .markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview h3, .markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview h3 .anchor, .markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview h4, .markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview h4 .anchor, .markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview h5, .markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview h5 .anchor, .markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview h6, .markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview h6 .anchor, .markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview p, .markdown-preview[data-use-github-style] p, .markdown-preview blockquote, .markdown-preview[data-use-github-style] blockquote, .markdown-preview ul, .markdown-preview[data-use-github-style] ul, .markdown-preview ol, .markdown-preview[data-use-github-style] ol, .markdown-preview dl, .markdown-preview[data-use-github-style] dl, .markdown-preview table, .markdown-preview[data-use-github-style] table, .markdown-preview pre, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview hr, .markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview ul, .markdown-preview[data-use-github-style] ul, .markdown-preview ol, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview ul.no-list, .markdown-preview[data-use-github-style] ul.no-list, .markdown-preview ol.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview ul ul, .markdown-preview[data-use-github-style] ul ul, .markdown-preview ul ol, .markdown-preview[data-use-github-style] ul ol, .markdown-preview ol ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview ol ul, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview li > p, .markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview dl, .markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview dl dt, .markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview dl dd, .markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview blockquote, .markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); }
.markdown-preview blockquote > :first-child, .markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview blockquote > :last-child, .markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview table, .markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: normal; }
.markdown-preview table th, .markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview table th, .markdown-preview[data-use-github-style] table th, .markdown-preview table td, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview table tr, .markdown-preview[data-use-github-style] table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview table tr:nth-child(2n), .markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview img, .markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview .emoji, .markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview span.frame, .markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview span.frame > span, .markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview span.frame span img, .markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview span.frame span span, .markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview span.align-center, .markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-center > span, .markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview span.align-center span img, .markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview span.align-right, .markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-right > span, .markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview span.align-right span img, .markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview span.float-left, .markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview span.float-left span, .markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview span.float-right, .markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview span.float-right > span, .markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview code, .markdown-preview[data-use-github-style] code, .markdown-preview tt, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview code::before, .markdown-preview[data-use-github-style] code::before, .markdown-preview tt::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview code::after, .markdown-preview[data-use-github-style] code::after, .markdown-preview tt::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: ' '; }
.markdown-preview code br, .markdown-preview[data-use-github-style] code br, .markdown-preview tt br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview del code, .markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview pre > code, .markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview .highlight, .markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview .highlight pre, .markdown-preview[data-use-github-style] .highlight pre, .markdown-preview pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview .highlight pre, .markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview pre, .markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview pre code, .markdown-preview[data-use-github-style] pre code, .markdown-preview pre tt, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview pre code::before, .markdown-preview[data-use-github-style] pre code::before, .markdown-preview pre tt::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview pre code::after, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview pre tt::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview kbd, .markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-style: solid; border-width: 1px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview, .markdown-preview[data-use-github-style], .markdown-preview code, .markdown-preview[data-use-github-style] code { color: rgb(51, 51, 51); }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1, .markdown-preview h2, .markdown-preview[data-use-github-style] h2, .markdown-preview h3, .markdown-preview[data-use-github-style] h3, .markdown-preview h4, .markdown-preview[data-use-github-style] h4, .markdown-preview h5, .markdown-preview[data-use-github-style] h5, .markdown-preview h6, .markdown-preview[data-use-github-style] h6 { -webkit-font-smoothing: antialiased; cursor: text; }
.markdown-preview > h1:first-child, .markdown-preview[data-use-github-style] > h1:first-child, .markdown-preview > h1:first-child + h2, .markdown-preview[data-use-github-style] > h1:first-child + h2, .markdown-preview > h2:first-child, .markdown-preview[data-use-github-style] > h2:first-child, .markdown-preview > h3:first-child, .markdown-preview[data-use-github-style] > h3:first-child, .markdown-preview > h4:first-child, .markdown-preview[data-use-github-style] > h4:first-child, .markdown-preview > h5:first-child, .markdown-preview[data-use-github-style] > h5:first-child, .markdown-preview > h6:first-child, .markdown-preview[data-use-github-style] > h6:first-child { margin-top: 0px; padding-top: 0px; }
.markdown-preview a, .markdown-preview[data-use-github-style] a, .markdown-preview a code, .markdown-preview[data-use-github-style] a code { color: rgb(65, 131, 196); }
.markdown-preview a:first-child h1, .markdown-preview[data-use-github-style] a:first-child h1, .markdown-preview a:first-child h2, .markdown-preview[data-use-github-style] a:first-child h2, .markdown-preview a:first-child h3, .markdown-preview[data-use-github-style] a:first-child h3, .markdown-preview a:first-child h4, .markdown-preview[data-use-github-style] a:first-child h4, .markdown-preview a:first-child h5, .markdown-preview[data-use-github-style] a:first-child h5, .markdown-preview a:first-child h6, .markdown-preview[data-use-github-style] a:first-child h6 { margin-top: 0px; padding-top: 0px; }
.markdown-preview h1 + p, .markdown-preview[data-use-github-style] h1 + p, .markdown-preview h2 + p, .markdown-preview[data-use-github-style] h2 + p, .markdown-preview h3 + p, .markdown-preview[data-use-github-style] h3 + p, .markdown-preview h4 + p, .markdown-preview[data-use-github-style] h4 + p, .markdown-preview h5 + p, .markdown-preview[data-use-github-style] h5 + p, .markdown-preview h6 + p, .markdown-preview[data-use-github-style] h6 + p { margin-top: 0px; }
.markdown-preview li p.first, .markdown-preview[data-use-github-style] li p.first { display: inline-block; }
.markdown-preview ul li > :first-child, .markdown-preview[data-use-github-style] ul li > :first-child, .markdown-preview ol li > :first-child, .markdown-preview[data-use-github-style] ol li > :first-child, .markdown-preview ul li ul:first-of-type, .markdown-preview[data-use-github-style] ul li ul:first-of-type, .markdown-preview ol li ul:first-of-type, .markdown-preview[data-use-github-style] ol li ul:first-of-type { margin-top: 0px; }
.markdown-preview ol > li, .markdown-preview[data-use-github-style] ol > li { list-style-type: decimal; }
.markdown-preview ul > li, .markdown-preview[data-use-github-style] ul > li { list-style-type: disc; }
.markdown-preview dl dt:first-child, .markdown-preview[data-use-github-style] dl dt:first-child { padding: 0px; }
.markdown-preview dl dt > :first-child, .markdown-preview[data-use-github-style] dl dt > :first-child { margin-top: 0px; }
.markdown-preview dl dt > :last-child, .markdown-preview[data-use-github-style] dl dt > :last-child { margin-bottom: 0px; }
.markdown-preview dl dd > :first-child, .markdown-preview[data-use-github-style] dl dd > :first-child { margin-top: 0px; }
.markdown-preview dl dd > :last-child, .markdown-preview[data-use-github-style] dl dd > :last-child { margin-bottom: 0px; }
.markdown-preview blockquote p, .markdown-preview[data-use-github-style] blockquote p { font-size: 16px; line-height: 1.5; }
.markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { padding: 16px; overflow: auto; font-size: 84%; line-height: 1.45; border-radius: 3px; background-color: rgb(40, 44, 52); }
.markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { margin-bottom: 16px; word-break: normal; }
.markdown-preview code, .markdown-preview[data-use-github-style] code, .markdown-preview tt, .markdown-preview[data-use-github-style] tt, .markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { font-family: Consolas, 'Liberation Mono', Courier, monospace; }
.markdown-preview .emoji, .markdown-preview[data-use-github-style] .emoji { height: 20px; width: 20px; }
.markdown-preview { font-size: 1.25em; color: rgb(200, 204, 213); background-color: rgb(47, 51, 61); }
.markdown-preview h1, .markdown-preview h2 { color: inherit; border-color: rgb(24, 26, 31); }
.markdown-preview a { color: rgb(100, 148, 237); }
.markdown-preview hr { background-color: rgb(67, 73, 86); }
.markdown-preview blockquote { color: rgb(157, 165, 180); border-left-color: rgba(157, 165, 180, 0.6); }
.markdown-preview table th, .markdown-preview table td { border-color: rgb(24, 26, 31); }
.markdown-preview table th { background-color: rgb(53, 59, 69); }
.markdown-preview table tr { background-color: rgb(47, 51, 61); }
.markdown-preview table tr:nth-child(2n) { background-color: rgb(40, 44, 52); }
.markdown-preview code { color: rgb(243, 244, 246); border-color: rgb(24, 26, 31); background-color: rgb(62, 68, 81); background-clip: padding-box; }
.markdown-preview pre.editor-colors::shadow .line.cursor-line { background-color: transparent; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 1px dashed rgba(250, 128, 114, 0.5);
}

pre.editor-colors,
.host {
  background-color: #282c34;
  color: #abb2bf;
}
pre.editor-colors .line.cursor-line,
.host .line.cursor-line {
  background-color: rgba(153, 187, 255, 0.04);
}
pre.editor-colors .invisible,
.host .invisible {
  color: #abb2bf;
}
pre.editor-colors .cursor,
.host .cursor {
  border-left: 2px solid #528bff;
}
pre.editor-colors .selection .region,
.host .selection .region {
  background-color: #3e4451;
}
pre.editor-colors .bracket-matcher .region,
.host .bracket-matcher .region {
  border-bottom: 1px solid #528bff;
  box-sizing: border-box;
  background-color: #353b45;
}
pre.editor-colors .invisible-character,
.host .invisible-character {
  color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .indent-guide,
.host .indent-guide {
  color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .wrap-guide,
.host .wrap-guide {
  background-color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .gutter .line-number,
.host .gutter .line-number {
  color: #636d83;
  -webkit-font-smoothing: antialiased;
}
pre.editor-colors .gutter .line-number.git-line-removed:before,
.host .gutter .line-number.git-line-removed:before {
  bottom: -3px;
}
pre.editor-colors .gutter .line-number.git-line-removed:after,
.host .gutter .line-number.git-line-removed:after {
  content: "";
  position: absolute;
  left: 0px;
  bottom: 0px;
  width: 25px;
  border-bottom: 1px dotted rgba(224, 82, 82, 0.5);
  pointer-events: none;
}
pre.editor-colors .gutter .line-number.cursor-line,
.host .gutter .line-number.cursor-line {
  color: #abb2bf;
  background-color: #2c313a;
}
pre.editor-colors .gutter .line-number.cursor-line-no-selection,
.host .gutter .line-number.cursor-line-no-selection {
  background-color: transparent;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #abb2bf;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #abb2bf;
}
pre.editor-colors .gutter .line-number.folded,
.host .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
.host .gutter .line-number:after,
pre.editor-colors .fold-marker:after,
.host .fold-marker:after {
  color: #abb2bf;
}
.comment {
  color: #5c6370;
  font-style: italic;
}
.entity.name.type {
  color: #e5c07b;
}
.entity.other.inherited-class {
  color: #98c379;
}
.keyword {
  color: #c678dd;
}
.keyword.control {
  color: #c678dd;
}
.keyword.operator {
  color: #abb2bf;
}
.keyword.other.special-method {
  color: #61afef;
}
.keyword.other.unit {
  color: #d19a66;
}
.storage {
  color: #c678dd;
}
.storage.type.annotation,
.storage.type.primitive {
  color: #c678dd;
}
.storage.modifier.package,
.storage.modifier.import {
  color: #abb2bf;
}
.constant {
  color: #d19a66;
}
.constant.variable {
  color: #d19a66;
}
.constant.character.escape {
  color: #56b6c2;
}
.constant.numeric {
  color: #d19a66;
}
.constant.other.color {
  color: #56b6c2;
}
.constant.other.symbol {
  color: #56b6c2;
}
.variable {
  color: #e06c75;
}
.variable.interpolation {
  color: #be5046;
}
.variable.parameter {
  color: #abb2bf;
}
.invalid.illegal {
  background-color: #e06c75;
  color: #282c34;
}
.string {
  color: #98c379;
}
.string.regexp {
  color: #56b6c2;
}
.string.regexp .source.ruby.embedded {
  color: #e5c07b;
}
.string.other.link {
  color: #e06c75;
}
.punctuation.definition.comment {
  color: #5c6370;
}
.punctuation.definition.method-parameters,
.punctuation.definition.function-parameters,
.punctuation.definition.parameters,
.punctuation.definition.separator,
.punctuation.definition.seperator,
.punctuation.definition.array {
  color: #abb2bf;
}
.punctuation.definition.heading,
.punctuation.definition.identity {
  color: #61afef;
}
.punctuation.definition.bold {
  color: #e5c07b;
  font-weight: bold;
}
.punctuation.definition.italic {
  color: #c678dd;
  font-style: italic;
}
.punctuation.section.embedded {
  color: #be5046;
}
.punctuation.section.method,
.punctuation.section.class,
.punctuation.section.inner-class {
  color: #abb2bf;
}
.support.class {
  color: #e5c07b;
}
.support.type {
  color: #56b6c2;
}
.support.function {
  color: #56b6c2;
}
.support.function.any-method {
  color: #61afef;
}
.entity.name.function {
  color: #61afef;
}
.entity.name.class,
.entity.name.type.class {
  color: #e5c07b;
}
.entity.name.section {
  color: #61afef;
}
.entity.name.tag {
  color: #e06c75;
}
.entity.other.attribute-name {
  color: #d19a66;
}
.entity.other.attribute-name.id {
  color: #61afef;
}
.meta.class {
  color: #e5c07b;
}
.meta.class.body {
  color: #abb2bf;
}
.meta.method-call,
.meta.method {
  color: #abb2bf;
}
.meta.definition.variable {
  color: #e06c75;
}
.meta.link {
  color: #d19a66;
}
.meta.require {
  color: #61afef;
}
.meta.selector {
  color: #c678dd;
}
.meta.separator {
  background-color: #373b41;
  color: #abb2bf;
}
.meta.tag {
  color: #abb2bf;
}
.none {
  color: #abb2bf;
}
.markup.bold {
  color: #d19a66;
  font-weight: bold;
}
.markup.changed {
  color: #c678dd;
}
.markup.deleted {
  color: #e06c75;
}
.markup.italic {
  color: #c678dd;
  font-style: italic;
}
.markup.heading .punctuation.definition.heading {
  color: #61afef;
}
.markup.inserted {
  color: #98c379;
}
.markup.list {
  color: #e06c75;
}
.markup.quote {
  color: #d19a66;
}
.markup.raw.inline {
  color: #98c379;
}
.source.cs .keyword.operator {
  color: #c678dd;
}
.source.css .property-name,
.source.css .property-value {
  color: #828997;
}
.source.css .property-name.support,
.source.css .property-value.support {
  color: #abb2bf;
}
.source.gfm .markup {
  -webkit-font-smoothing: auto;
}
.source.gfm .markup.heading {
  color: #e06c75;
}
.source.gfm .markup.link {
  color: #c678dd;
}
.source.gfm .link .entity {
  color: #61afef;
}
.source.ini .keyword.other.definition.ini {
  color: #e06c75;
}
.source.java .storage.modifier.import {
  color: #e5c07b;
}
.source.java .storage.type {
  color: #e5c07b;
}
.source.java-properties .meta.key-pair {
  color: #e06c75;
}
.source.java-properties .meta.key-pair > .punctuation {
  color: #abb2bf;
}
.source.json .meta.structure.dictionary.json > .string.quoted.json {
  color: #e06c75;
}
.source.json .meta.structure.dictionary.json > .string.quoted.json > .punctuation.string {
  color: #e06c75;
}
.source.json .meta.structure.dictionary.json > .value.json > .string.quoted.json,
.source.json .meta.structure.array.json > .value.json > .string.quoted.json,
.source.json .meta.structure.dictionary.json > .value.json > .string.quoted.json > .punctuation,
.source.json .meta.structure.array.json > .value.json > .string.quoted.json > .punctuation {
  color: #98c379;
}
.source.json .meta.structure.dictionary.json > .constant.language.json,
.source.json .meta.structure.array.json > .constant.language.json {
  color: #56b6c2;
}
.source.ruby .constant.other.symbol > .punctuation {
  color: inherit;
}
.source.python .keyword.operator.logical.python {
  color: #c678dd;
}
.source.python .variable.parameter {
  color: #d19a66;
}
</style>
  </head>
  <body class='markdown-preview'><h1 id="ine5424-so-ii-p3-parallel-philosopher-s-dinner">INE5424 - SO II - P3: Parallel Philosopher&#39;s Dinner</h1>
<p>Alunos:</p>
<ul>
<li>Glaucia de Pádua da Silva - 09232087</li>
<li>Quenio Cesar Machado dos Santos - 14100868</li>
</ul>
<h2 id="multihead-queue-round-robin">Multihead Queue &amp; Round-Robin</h2>
<p>A classe <code>Scheduling_Queue</code>, que é a classe base de <code>Scheduler</code>, agora herda da classe <code>Multihead_Scheduling_List</code>. Esta última permite <code>Scheduler</code> ter várias cabeças em sua fila. Com as modificações feitas na classe <code>Round-Robin</code>, cada cabeça corresponderá a uma CPU. Desta forma, <code>Scheduler</code> poderá distribuir a alocação de <code>threads</code> entre as CPUs disponíveis. Veja abaixo, a nova classe base de <code>Scheduling_Queue</code>:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Scheduling_Queue</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="storage type template cpp"><span>template</span></span><span>&lt;</span><span class="storage modifier cpp"><span>typename</span></span><span>&nbsp;T,&nbsp;</span><span class="storage modifier cpp"><span>typename</span></span><span>&nbsp;R&nbsp;=&nbsp;</span><span class="storage modifier cpp"><span>typename</span></span><span>&nbsp;T::Criterion&gt;</span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage type cpp"><span>class</span></span><span>&nbsp;</span><span class="entity name type cpp"><span>Scheduling_Queue</span></span><span>:&nbsp;</span><span class="storage type modifier cpp"><span>public</span></span><span>&nbsp;</span><span class="entity name type inherited cpp"><span>Multihead_Scheduling_List</span></span><span class="meta angle-brackets cpp"><span>&lt;</span><span>T</span><span>&gt;</span></span><span>&nbsp;</span><span class="punctuation section block begin cpp"><span>{</span></span><span class="punctuation section block end cpp"><span>}</span></span></span><span>;</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;</span></span></div><div class="line"><span class="source cpp"><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Scheduler</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Objects&nbsp;subject&nbsp;to&nbsp;scheduling&nbsp;by&nbsp;Scheduler&nbsp;must&nbsp;declare&nbsp;a&nbsp;type&nbsp;&quot;Criterion&quot;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;scheduling&nbsp;queue&nbsp;sorting&nbsp;criterion&nbsp;(viz,&nbsp;through</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;operators&nbsp;&lt;,&nbsp;&gt;,&nbsp;and&nbsp;==)&nbsp;and&nbsp;must&nbsp;also&nbsp;define&nbsp;a&nbsp;method&nbsp;&quot;link&quot;&nbsp;to&nbsp;export&nbsp;the</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;list&nbsp;element&nbsp;pointing&nbsp;to&nbsp;the&nbsp;object&nbsp;being&nbsp;handled.</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="storage type template cpp"><span>template</span></span><span>&lt;</span><span class="storage modifier cpp"><span>typename</span></span><span>&nbsp;T&gt;</span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage type cpp"><span>class</span></span><span>&nbsp;</span><span class="entity name type cpp"><span>Scheduler</span></span><span>:&nbsp;</span><span class="storage type modifier cpp"><span>public</span></span><span>&nbsp;</span><span class="entity name type inherited cpp"><span>Scheduling_Queue</span></span><span class="meta angle-brackets cpp"><span>&lt;</span><span>T</span><span>&gt;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="punctuation section block begin cpp"><span>{</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;...</span></span></span></div></pre>
<p>Para que <code>Scheduler</code> funcione com uma <code>Multihead_Scheduling_List</code>, foi preciso alterar a política round-robin para definir que o número de cabeças na lista corresponde ao número de CPUs e também qual a cabeça da fila corresponde a CPU em execução. Veja abaixo:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Round-Robin</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage type cpp"><span>class</span></span><span>&nbsp;</span><span class="entity name type cpp"><span>RR</span></span><span>:&nbsp;</span><span class="storage type modifier cpp"><span>public</span></span><span>&nbsp;</span><span class="entity name type inherited cpp"><span>Priority</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="punctuation section block begin cpp"><span>{</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage modifier cpp"><span>public:</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type c"><span>enum</span></span><span>&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAIN&nbsp;&nbsp;&nbsp;=&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>,</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NORMAL&nbsp;=&nbsp;</span><span class="constant numeric c"><span>1</span></span><span>,</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDLE&nbsp;&nbsp;&nbsp;=&nbsp;(</span><span class="meta function-call c"><span class="support function any-method c"><span>unsigned</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span class="constant numeric c"><span>1</span></span><span>)&nbsp;&lt;&lt;&nbsp;(</span><span class="keyword operator sizeof c"><span>sizeof</span></span><span>(</span><span class="storage type c"><span>int</span></span><span>)&nbsp;*&nbsp;</span><span class="constant numeric c"><span>8</span></span><span>&nbsp;-&nbsp;</span><span class="constant numeric c"><span>1</span></span><span>))&nbsp;-&nbsp;</span><span class="constant numeric c"><span>1</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span><span>;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>bool</span></span><span>&nbsp;timed&nbsp;=&nbsp;</span><span class="constant language c"><span>true</span></span><span>;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>bool</span></span><span>&nbsp;dynamic&nbsp;=&nbsp;</span><span class="constant language c"><span>false</span></span><span>;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>bool</span></span><span>&nbsp;preemptive&nbsp;=&nbsp;</span><span class="constant language c"><span>true</span></span><span>;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>unsigned</span></span><span>&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;HEADS&nbsp;=&nbsp;Traits&lt;Build&gt;::CPUS;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage type c"><span>int</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>current_head</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span><span>&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span><span>&nbsp;</span><span class="keyword control c"><span>return</span></span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage modifier cpp"><span>public:</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function constructor cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name function cpp"><span>RR</span></span><span class="punctuation definition parameters begin c"><span>(</span></span><span class="storage type c"><span>int</span></span><span>&nbsp;p&nbsp;=&nbsp;NORMAL</span><span class="punctuation definition parameters end c"><span>)</span></span></span><span class="meta function constructor initializer-list cpp"><span class="punctuation definition parameters c"><span>:</span></span><span>&nbsp;Priority(p)&nbsp;</span></span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span><span class="punctuation section block end c"><span>}</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="punctuation section block end cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<p>Observe que <code>HEADS</code> acima é a constante que informa a <code>Scheduler</code> o número de cabeças necessárias (uma para cada CPU), enquanto <code>current_head()</code> vai informar qual é a cabeça para a CPU em execução.</p>
<h2 id="spin-lock-escalonamento">Spin Lock &amp; Escalonamento</h2>
<p>Para que o escalonamento de <code>threads</code> funcione corretamente num ambiente multi-processado, foi preciso modificar o mecanismo de <code>locking</code> na classe <code>Thread</code>. Desabilitar as interrupções do processador corrente não é suficiente, pois as outras CPUs poderiam executar as seções críticas da classe <code>Thread</code>.</p>
<p>Para solucionar este problema, foi utilizado a classe <code>Spin</code>, que implementa um <code>spin lock</code> utilizando a primitiva de sincronização <code>cas</code> - <code>compare-and-swap</code>. Na arquitetura IA32, a primitiva <code>cas</code> é implementada pela instrução <code>lock cmpxchgl</code> que garante atomicidade e coerência de cache entre todas as CPUs do sistema.</p>
<p>Veja abaixo as alterações na classe <code>Thread</code> referente ao métodos <code>lock()</code> e <code>unlock()</code>:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage type cpp"><span>class</span></span><span>&nbsp;</span><span class="entity name type cpp"><span>Thread</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="punctuation section block begin cpp"><span>{</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;...</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>lock</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span>&nbsp;&nbsp;&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::int_disable</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>spinLock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>unlock</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span>&nbsp;&nbsp;&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>spinUnlock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::int_enable</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;...</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage modifier cpp"><span>private:</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>spinLock</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span><span>&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span><span>&nbsp;</span><span class="keyword control c"><span>if</span></span><span>&nbsp;(smp)&nbsp;_spinLock.</span><span class="meta function-call c"><span class="support function any-method c"><span>acquire</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>spinUnlock</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span><span>&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span><span>&nbsp;</span><span class="keyword control c"><span>if</span></span><span>&nbsp;(smp)&nbsp;_spinLock.</span><span class="meta function-call c"><span class="support function any-method c"><span>release</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;</span><span class="storage modifier cpp"><span>protected:</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;Spin&nbsp;_spinLock;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;&nbsp;...</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="punctuation section block end cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<p>Além das alterações acima, também foi preciso modificar o método <code>Thread::dispatch()</code> para que este libere o <code>spin lock</code> antes de mudar de contexto:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Thread::dispatch</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span>Thread&nbsp;*&nbsp;prev,&nbsp;Thread&nbsp;*&nbsp;next,&nbsp;</span><span class="storage type c"><span>bool</span></span><span>&nbsp;charge</span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(charge)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(Criterion::timed)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_timer-&gt;</span><span class="meta function-call c"><span class="support function any-method c"><span>reset</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(prev&nbsp;!=&nbsp;next)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(prev-&gt;_state&nbsp;==&nbsp;RUNNING)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prev-&gt;_state&nbsp;=&nbsp;READY;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next-&gt;_state&nbsp;=&nbsp;RUNNING;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>spinUnlock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::switch_context</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>&amp;prev-&gt;_context,&nbsp;next-&gt;_context);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span><span>&nbsp;</span><span class="keyword control c"><span>else</span></span><span>&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>spinUnlock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::int_enable</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div></pre>
<p>Sem as alterações acima, todas as CPUs ficariam bloqueadas pelo <code>spin lock</code> e nenhum <code>thread</code> poderia executar, ou seja, <code>thread starvation</code>.</p>
<h2 id="corre-o-em-heap-">Correção em <code>Heap</code></h2>
<p>No método <code>enter()</code> da classe <code>Heap_Wrapper</code>, moveu-se a desabilitação das interrupções para antes de adquirir o <code>spin lock</code>. Isto evita que haja uma troca de contexto para outro <code>thread</code> sem a liberação da <code>spin lock</code>, o que poderia bloquear todas CPUs que estejam alocando memória na <code>heap</code>. Veja abaixo:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="storage type cpp"><span>class</span></span><span>&nbsp;</span><span class="entity name type cpp"><span>Heap_Wrapper</span></span><span>&nbsp;...</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="punctuation section block begin cpp"><span>{</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;...</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;</span><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>enter</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span><span>&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::int_disable</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lock.</span><span class="meta function-call c"><span class="support function any-method c"><span>acquire</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span>&nbsp;&nbsp;...</span></span></span></div><div class="line"><span class="source cpp"><span class="meta class-struct-block cpp"><span class="punctuation section block end cpp"><span>}</span></span><span class="invalid illegal you-forgot-semicolon cpp"><span>&nbsp;</span></span></span></span></div></pre>
<h2 id="corre-o-em-init_first-cc-">Correção em <code>init_first.cc</code></h2>
<p>Em <code>init_first</code>, quando criando os <code>idle threads</code> das APs, marcando o <code>idle thread</code> como <code>RUNNING</code>, visto que inicialmente seu contexto será carregado em <code>init_first</code>, ao invés de ser escalonado:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="keyword control c"><span>if</span></span><span>(Machine::cpu_id()&nbsp;==&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;=</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>new</span></span><span>&nbsp;</span><span class="punctuation definition parameters c"><span>(</span></span></span><span>SYSTEM)</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Thread</span></span><span class="punctuation definition parameters c"><span>(</span></span><span class="support function any-method c"><span>Thread::Configuration</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>Thread::RUNNING,&nbsp;Thread::MAIN),&nbsp;</span><span class="keyword operator cast cpp"><span>reinterpret_cast</span></span><span>&lt;</span><span class="meta function-call c"><span class="support function any-method c"><span>int</span></span><span>&nbsp;</span><span class="punctuation definition parameters c"><span>(</span></span></span><span>*)()&gt;(__epos_app_entry));</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="punctuation whitespace comment leading c++"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Idle&nbsp;thread&nbsp;creation&nbsp;must&nbsp;succeed&nbsp;main,&nbsp;thus&nbsp;avoiding&nbsp;implicit&nbsp;rescheduling.</span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>new</span></span><span>&nbsp;</span><span class="punctuation definition parameters c"><span>(</span></span></span><span>SYSTEM)</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Thread</span></span><span class="punctuation definition parameters c"><span>(</span></span><span class="support function any-method c"><span>Thread::Configuration</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>Thread::READY,&nbsp;Thread::IDLE),&nbsp;&amp;Thread::idle);</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span><span>&nbsp;</span><span class="keyword control c"><span>else</span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;=&nbsp;</span><span class="keyword control cpp"><span>new</span></span><span>&nbsp;(SYSTEM)&nbsp;Thread(Thread::Configuration(Thread::RUNNING,&nbsp;Thread::IDLE),&nbsp;&amp;Thread::idle);</span></span></div></pre>
<h2 id="corre-o-em-init_system-cc-">Correção em <code>init_system.cc</code></h2>
<p>Foi feita a equalização das barreiras em <code>init_system.cc</code> entre a BSP e as APs para garantir que todas as CPUs:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span>---&nbsp;src/init/init_system.cc&nbsp;&nbsp;&nbsp;&nbsp;(revision&nbsp;</span><span class="constant numeric c"><span>3782</span></span><span>)</span></span></div><div class="line"><span class="source cpp"><span>+++&nbsp;src/init/init_system.cc&nbsp;&nbsp;&nbsp;&nbsp;(working&nbsp;copy)</span></span></div><div class="line"><span class="source cpp"><span class="punctuation whitespace comment leading c++"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Only&nbsp;the&nbsp;boot&nbsp;CPU&nbsp;runs&nbsp;INIT_SYSTEM&nbsp;fully</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(Machine::cpu_id()&nbsp;!=&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="punctuation whitespace comment leading c++"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Wait&nbsp;until&nbsp;the&nbsp;boot&nbsp;CPU&nbsp;has&nbsp;initialized&nbsp;the&nbsp;machine</span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Machine::smp_barrier</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="punctuation whitespace comment leading c++"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;For&nbsp;IA-32,&nbsp;timer&nbsp;is&nbsp;CPU-local.&nbsp;What&nbsp;about&nbsp;other&nbsp;SMPs?</span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Timer::init</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Machine::smp_barrier</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span>@@&nbsp;-</span><span class="constant numeric c"><span>66</span></span><span>,</span><span class="constant numeric c"><span>6</span></span><span>&nbsp;+</span><span class="constant numeric c"><span>66</span></span><span>,</span><span class="constant numeric c"><span>8</span></span><span>&nbsp;@@</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Init&gt;(INF)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>done!</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></div><div class="line"><span class="source cpp"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;</span></span></div><div class="line"><span class="source cpp"><span>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Machine::smp_barrier();</span></span></div><div class="line"><span class="source cpp"><span>+</span></span></div><div class="line"><span class="source cpp"><span class="punctuation whitespace comment leading c++"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;Initialization&nbsp;continues&nbsp;at&nbsp;init_first</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;};</span></span></div></pre>
<h2 id="t-rmino-da-execu-o">Término da Execução</h2>
<p>Uma vez que todos os <code>threads</code> terminarem sua execução, somente os <code>idle threads</code> estarão rodando nas CPUs. Por esta razão, o termino da execução do sistema se dá em <code>Thread::idle()</code>. Aqui somente a BSP irá desligar a máquina. As outras CPUs vão apenas desativar-se - <code>halt()</code> - mas antes desabilitam suas interrupções para evitar que sejam acordadas novamente. </p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="storage type c"><span>int</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Thread::idle</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>while</span></span><span>(_thread_count&nbsp;&gt;</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Machine::n_cpus</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>))&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span><span>&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;someone&nbsp;else&nbsp;besides&nbsp;idles</span><span>&nbsp;</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(Traits&lt;Thread&gt;::trace_idle)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Thread&gt;(WRN)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted single c"><span class="punctuation definition string begin c"><span>&#39;</span></span><span>i</span><span class="punctuation definition string end c"><span>&#39;</span></span></span><span>&nbsp;&lt;&lt;</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::int_enable</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::halt</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::int_disable</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(</span><span class="meta function-call c"><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>)&nbsp;==&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Thread&gt;(WRN)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>The&nbsp;last&nbsp;thread&nbsp;has&nbsp;exited!</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(reboot)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Thread&gt;(WRN)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>Rebooting&nbsp;the&nbsp;machine&nbsp;...</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Machine::reboot</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span><span>&nbsp;</span><span class="keyword control c"><span>else</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Thread&gt;(WRN)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>Halting&nbsp;the&nbsp;machine&nbsp;...</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>CPU::halt</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>return</span></span><span>&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div></pre>
<h2 id="verifica-o-dos-mecanismos-de-locking-do-epos">Verificação dos mecanismos de <code>locking</code> do EPOS</h2>
<p>Foi feita uma verificação dos mecanismos de <code>locking</code> de todo a sistema para guarantir seu funcionamento num ambiente multi-processado. Veja a seguir nas sub-seções abaixo.</p>
<h3 id="-mutex-"><code>Mutex</code></h3>
<p>O método <code>lock()</code> de <code>Mutex</code> utiliza a primitiva atomica <code>tsl</code> - <code>test-and-set</code> - que vai retornar o valor atual de <code>_lock</code> e depois marcá-lo. Na arquitetura IA32, <code>tsl</code> é implementada pela instrução <code>lock xchg</code> que garante atomicidade e coerência de cache entre todas as CPUs do sistema. Veja baixo:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Mutex::lock</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Synchronizer&gt;(TRC)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>Mutex::lock(this=</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="variable language this cpp"><span>this</span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>)</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>begin_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(</span><span class="meta function-call c"><span class="support function any-method c"><span>tsl</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>_locked))</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>sleep</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;implicit&nbsp;end_atomic()</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>else</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>end_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;</span></span></div><div class="line"><span class="source cpp"><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Mutex::unlock</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Synchronizer&gt;(TRC)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>Mutex::unlock(this=</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="variable language this cpp"><span>this</span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>)</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>begin_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(_queue.</span><span class="meta function-call c"><span class="support function any-method c"><span>empty</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>))&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_locked&nbsp;=&nbsp;</span><span class="constant language c"><span>false</span></span><span>;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>end_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span><span>&nbsp;</span><span class="keyword control c"><span>else</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>wakeup</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;implicit&nbsp;end_atomic()</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div></pre>
<p>Além disso, <code>begin_atomic()</code> e <code>end_atomic()</code>, implementados respectivamente por <code>Thread::lock()</code> e <code>Thread::unlock()</code> em <code>synchronizer.h</code>, protegem a execução de <code>sleep()</code> e <code>wakeup()</code>, e do acesso a <code>_queue</code> de espera.</p>
<h3 id="-semaphore-"><code>Semaphore</code></h3>
<p>Da mesma forma que no caso do <code>Mutex</code>, <code>Semaphore</code> utiliza <code>begin_atomic()</code> e <code>end_atomic()</code> para proteger seus métodos <code>p()</code> e <code>v()</code>.</p>
<p>Para incrementar seu contador, <code>Semaphore</code> utiliza as primitivas atômicas <code>finc()</code> e <code>fdec()</code> que garantem a coerência de cache entre todas as CPUs, pois ambas utilizam a instrução <code>lock xadd</code> da arquitetura IA32.</p>
<p>Veja a seguir de <code>p()</code> e <code>v()</code>:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Semaphore::p</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Synchronizer&gt;(TRC)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>Semaphore::p(this=</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="variable language this cpp"><span>this</span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>,value=</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;_value&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>)</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>begin_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(</span><span class="meta function-call c"><span class="support function any-method c"><span>fdec</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>_value)&nbsp;&lt;&nbsp;</span><span class="constant numeric c"><span>1</span></span><span>)</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>sleep</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;implicit&nbsp;end_atomic()</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>else</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>end_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;</span></span></div><div class="line"><span class="source cpp"><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Semaphore::v</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;db&lt;Synchronizer&gt;(TRC)&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>Semaphore::v(this=</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="variable language this cpp"><span>this</span></span><span>&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>,value=</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;_value&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>)</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;endl;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>begin_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>(</span><span class="meta function-call c"><span class="support function any-method c"><span>finc</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>_value)&nbsp;&lt;&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>)</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>wakeup</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;implicit&nbsp;end_atomic()</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>else</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>end_atomic</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div></pre>
<h3 id="-alarm-"><code>Alarm</code></h3>
<p>O handler de interrupção que dispara <code>Alarm::handler()</code> é implementado em <code>PC_Timer</code>. Este somente vai disparar os alarmes na BSP:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="storage type c"><span>void</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>PC_Timer::int_handler</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="storage modifier c"><span>const</span></span><span>&nbsp;Interrupt_Id&nbsp;&amp;&nbsp;i</span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;...</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>((!Traits&lt;System&gt;::multicore&nbsp;||&nbsp;(Traits&lt;System&gt;::multicore&nbsp;&amp;&amp;&nbsp;(</span><span class="meta function-call c"><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>)&nbsp;==&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>)))&nbsp;&amp;&amp;&nbsp;_channels[ALARM])&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_channels[ALARM]-&gt;_current[</span><span class="constant numeric c"><span>0</span></span><span>]&nbsp;=&nbsp;_channels[ALARM]-&gt;_initial;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_channels[ALARM]-&gt;</span><span class="meta function-call c"><span class="support function any-method c"><span>_handler</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>i);</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;...</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div></pre>
<p>Portanto, poderia-se pensar que não haveria a necessidade de usar um <code>spin lock</code> para os alarmes, mas <code>Thread::lock()/unlock()</code> são usados para processar os <code>requests</code> de alarmes porque é preciso haver sincronização com os outros métodos de <code>Alarm</code>:</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>void&nbsp;Alarm::handler(const&nbsp;IC::Interrupt_Id&nbsp;&amp;&nbsp;i)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>lock();</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>_elapsed++;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;Alarm&nbsp;*&nbsp;alarm&nbsp;=&nbsp;0;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>if(!_request.empty())&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>if(_request.head()-&gt;promote()&nbsp;&lt;=&nbsp;0)&nbsp;{&nbsp;//&nbsp;rank&nbsp;can&nbsp;be&nbsp;negative&nbsp;whenever&nbsp;multiple&nbsp;handlers&nbsp;get&nbsp;created&nbsp;for&nbsp;the&nbsp;same&nbsp;time&nbsp;tick</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>Queue::Element&nbsp;*&nbsp;e&nbsp;=&nbsp;_request.remove();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alarm&nbsp;=&nbsp;e-&gt;object();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(alarm-&gt;_times&nbsp;!=&nbsp;INFINITE)</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>alarm-&gt;_times--;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>if(alarm-&gt;_times)&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>e-&gt;rank(alarm-&gt;_ticks);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_request.insert(e);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>unlock();</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>if(alarm)&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>(*alarm-&gt;_handler)();</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><h2 id="o-jantar-dos-fil-sofos-em-8-cpus">O Jantar dos Filósofos em 8 CPUs</h2>
<p>Dada as verificações e alterações acima, podemos agora fazer algumas modificações no programa &quot;jantar dos filófosos&quot; para demonstrar a execução adequada em múltiplos processadores.</p>
<p>Primeiramente, vamos alterar a configuração para rodar o programa em 8 CPUs:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span>---&nbsp;include/system/traits.h&nbsp;&nbsp;&nbsp;&nbsp;(revision&nbsp;</span><span class="constant numeric c"><span>3782</span></span><span>)</span></span></div><div class="line"><span class="source cpp"><span>+++&nbsp;include/system/traits.h&nbsp;&nbsp;&nbsp;&nbsp;(working&nbsp;copy)</span></span></div><div class="line"><span class="source cpp"><span>@@&nbsp;-</span><span class="constant numeric c"><span>28</span></span><span>,</span><span class="constant numeric c"><span>7</span></span><span>&nbsp;+</span><span class="constant numeric c"><span>28</span></span><span>,</span><span class="constant numeric c"><span>7</span></span><span>&nbsp;@@</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type c"><span>enum</span></span><span>&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span><span>Legacy</span><span class="punctuation section block end c"><span>}</span></span></span><span>;</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>unsigned</span></span><span>&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;MODEL&nbsp;=&nbsp;Legacy;</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;</span></span></div><div class="line"><span class="source cpp"><span>-&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>unsigned</span></span><span>&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;CPUS&nbsp;=&nbsp;</span><span class="constant numeric c"><span>1</span></span><span>;</span></span></div><div class="line"><span class="source cpp"><span>+&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>unsigned</span></span><span>&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;CPUS&nbsp;=&nbsp;</span><span class="constant numeric c"><span>8</span></span><span>;</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier c"><span>static</span></span><span>&nbsp;</span><span class="storage modifier c"><span>const</span></span><span>&nbsp;</span><span class="storage type c"><span>unsigned</span></span><span>&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;NODES&nbsp;=&nbsp;</span><span class="constant numeric c"><span>1</span></span><span>;&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;&gt;&nbsp;1&nbsp;=&gt;&nbsp;NETWORKING</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;};</span></span></div></pre>
<p> A seguir, vamos alterar as mensagens &quot;thinking&quot; e &quot;eating&quot; para também imprimir o <code>id</code> da CPU:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span>&nbsp;table.lock();</span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Display::position</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span>l,&nbsp;c</span><span class="punctuation section parens end c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>thinking&nbsp;</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;Machine::cpu_id();</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;table.unlock();</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;...</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;table.lock();</span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>Display::position</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span>l,&nbsp;c</span><span class="punctuation section parens end c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="source cpp"><span>&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>&nbsp;eating&nbsp;&nbsp;</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;Machine::cpu_id();</span></span></div><div class="line"><span class="source cpp"><span>&nbsp;table.unlock();</span></span></div></pre>
<p>Para garantir a plena utilização de todas as CPUs, vamos implementar um algoritmo a ser executado quando o &quot;filófoso&quot; estiver &quot;comendo&quot;:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="storage type c"><span>bool</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>is_even</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="storage type c"><span>int</span></span><span>&nbsp;n</span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="storage type c"><span>bool</span></span><span>&nbsp;result&nbsp;=&nbsp;</span><span class="constant language c"><span>true</span></span><span>;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="keyword control c"><span>while</span></span><span>&nbsp;(n&nbsp;&gt;&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n--;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;!result;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="keyword control c"><span>return</span></span><span>&nbsp;result;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div><div class="line"><span class="source cpp"><span>...</span></span></div><div class="line"><span class="source cpp"><span class="storage type c"><span>int</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>count_even_numbers</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;n&nbsp;=&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="keyword control c"><span>for</span></span><span>(</span><span class="storage type c"><span>int</span></span><span>&nbsp;i&nbsp;=&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>;&nbsp;i&nbsp;&lt;&nbsp;</span><span class="constant numeric c"><span>30000</span></span><span>;&nbsp;i++)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>&nbsp;(</span><span class="meta function-call c"><span class="support function any-method c"><span>is_even</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>i))&nbsp;n++;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="keyword control c"><span>return</span></span><span>&nbsp;n;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div><div class="line"><span class="source cpp"><span>...</span></span></div><div class="line"><span class="source cpp"><span class="storage type c"><span>int</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>philosopher</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="storage type c"><span>int</span></span><span>&nbsp;n,&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;l,&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;c</span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;...</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;chopstick[first]-&gt;</span><span class="meta function-call c"><span class="support function any-method c"><span>p</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;get&nbsp;first&nbsp;chopstick</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;chopstick[second]-&gt;</span><span class="meta function-call c"><span class="support function any-method c"><span>p</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;get&nbsp;second&nbsp;chopstick</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>lock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Display::position</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>l,&nbsp;c);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>&nbsp;eating&nbsp;&nbsp;</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>unlock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;n&nbsp;=</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>count_even_numbers</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>lock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Display::position</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span class="constant numeric c"><span>3</span></span><span>,&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>even&nbsp;numbers:&nbsp;</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;n&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>-</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>unlock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;chopstick[first]-&gt;</span><span class="meta function-call c"><span class="support function any-method c"><span>v</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;release&nbsp;first&nbsp;chopstick</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;chopstick[second]-&gt;</span><span class="meta function-call c"><span class="support function any-method c"><span>v</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash c++"><span class="punctuation definition comment c++"><span>//</span></span><span>&nbsp;release&nbsp;second&nbsp;chopstick</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;...</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div></pre>
<p>E também outro algoritmo para quando o &quot;filósofo&quot; estiver &quot;pensando&quot;:</p>
<pre class="editor-colors lang-cpp"><div class="line"><span class="source cpp"><span class="storage type c"><span>int</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>count_odd_numbers</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;*n&nbsp;=</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>new</span></span><span>&nbsp;</span><span class="punctuation definition parameters c"><span>(</span></span></span><span>SYSTEM)&nbsp;</span><span class="storage type c"><span>int</span></span><span>;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;*n&nbsp;=&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="keyword control c"><span>for</span></span><span>(</span><span class="storage type c"><span>int</span></span><span>&nbsp;i&nbsp;=&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>;&nbsp;i&nbsp;&lt;&nbsp;</span><span class="constant numeric c"><span>20000</span></span><span>;&nbsp;i++)&nbsp;</span><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control c"><span>if</span></span><span>&nbsp;(!</span><span class="meta function-call c"><span class="support function any-method c"><span>is_even</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>i))&nbsp;(*n)++;</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="punctuation section block end c"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;result&nbsp;=&nbsp;*n;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="keyword control cpp"><span>delete</span></span><span>&nbsp;n;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="keyword control c"><span>return</span></span><span>&nbsp;result;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div><div class="line"><span class="source cpp"><span>...</span></span></div><div class="line"><span class="source cpp"><span class="storage type c"><span>int</span></span><span class="meta function c"><span class="punctuation whitespace function leading c"><span>&nbsp;</span></span><span class="entity name function c"><span>philosopher</span></span><span class="meta parens c"><span class="punctuation section parens begin c"><span>(</span></span><span class="storage type c"><span>int</span></span><span>&nbsp;n,&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;l,&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;c</span><span class="punctuation section parens end c"><span>)</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block begin c"><span>{</span></span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;...</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>lock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Display::position</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>l,&nbsp;c);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>thinking&nbsp;</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>unlock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;</span><span class="storage type c"><span>int</span></span><span>&nbsp;n&nbsp;=</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>count_odd_numbers</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>lock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;&nbsp;</span></span><span class="support function any-method c"><span>Display::position</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span class="constant numeric c"><span>3</span></span><span>,&nbsp;</span><span class="constant numeric c"><span>0</span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>&nbsp;odd&nbsp;numbers:&nbsp;</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;&nbsp;n&nbsp;&lt;&lt;&nbsp;</span><span class="string quoted double c"><span class="punctuation definition string begin c"><span>&quot;</span></span><span>-</span><span class="punctuation definition string end c"><span>&quot;</span></span></span><span>&nbsp;&lt;&lt;</span><span class="meta function-call c"><span class="punctuation whitespace function-call leading c"><span>&nbsp;</span></span><span class="support function any-method c"><span>Machine::cpu_id</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;table.</span><span class="meta function-call c"><span class="support function any-method c"><span>unlock</span></span><span class="punctuation definition parameters c"><span>(</span></span></span><span>);</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span>&nbsp;&nbsp;...</span></span></span></span></div><div class="line"><span class="source cpp"><span class="meta function c"><span class="meta block c"><span class="punctuation section block end c"><span>}</span></span></span></span></span></div></pre>
<p>Observe acima que também estamos testando a <code>heap</code> com as alocações de <code>n</code> em <code>count_odd_numbers()</code>.</p>
<p>Após executar o programa com as modificações acima, observou-se que este roda de maneira confiável inúmeras vezes, sempre distribuindo a execução entre as várias CPUs:</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Setting&nbsp;up&nbsp;this&nbsp;machine&nbsp;as&nbsp;follows:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>Processor:&nbsp;&nbsp;&nbsp;&nbsp;IA32&nbsp;at&nbsp;3098&nbsp;MHz&nbsp;(BUS&nbsp;clock&nbsp;=&nbsp;125&nbsp;MHz)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;Memory:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;262144&nbsp;Kbytes&nbsp;[0x00000000:0x10000000]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;User&nbsp;memory:&nbsp;&nbsp;261688&nbsp;Kbytes&nbsp;[0x00000000:0x0ff8e000]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;PCI&nbsp;aperture:&nbsp;44996&nbsp;Kbytes&nbsp;[0xfc000000:0xfebf1000]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;Node&nbsp;Id:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;get&nbsp;from&nbsp;the&nbsp;network!</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;Setup:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;21376&nbsp;bytes</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;APP&nbsp;code:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;31536&nbsp;bytes&nbsp;&nbsp;&nbsp;&nbsp;data:&nbsp;672&nbsp;bytes</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;CPU&nbsp;count:&nbsp;&nbsp;&nbsp;&nbsp;8</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[2J[000;000HThe&nbsp;Philosopher&#39;s&nbsp;Dinner:</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Philosophers&nbsp;are&nbsp;alive&nbsp;and&nbsp;hungry!</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[007;044H/[013;044H\[016;035H|[013;027H/[007;027H\[019;000HThe&nbsp;dinner&nbsp;is&nbsp;served&nbsp;...</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[005;032Hthinking&nbsp;0[010;044Hthinking&nbsp;0[016;039Hthinking&nbsp;0[016;024Hthinking&nbsp;2[010;020Hthinking&nbsp;1[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-5[005;032H&nbsp;eating&nbsp;&nbsp;5[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-2[016;039H&nbsp;eating&nbsp;&nbsp;2[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-0[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-1[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-3[003;000Heven&nbsp;numbers:&nbsp;15000-2[016;024H&nbsp;eating&nbsp;&nbsp;2[016;039Hthinking&nbsp;7[003;000Heven&nbsp;numbers:&nbsp;15000-5[010;044H&nbsp;eating&nbsp;&nbsp;5[005;032Hthinking&nbsp;5[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-7[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-5[003;000Heven&nbsp;numbers:&nbsp;15000-2[010;020H&nbsp;eating&nbsp;&nbsp;2[016;024Hthinking&nbsp;7[003;000Heven&nbsp;numbers:&nbsp;15000-4[016;039H&nbsp;eating&nbsp;&nbsp;4[010;044Hthinking&nbsp;4[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-4[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-7[003;000Heven&nbsp;numbers:&nbsp;15000-2[010;020Hthinking&nbsp;2[003;000Heven&nbsp;numbers:&nbsp;15000-0[010;044H&nbsp;eating&nbsp;&nbsp;0[016;024H&nbsp;eating&nbsp;&nbsp;5[016;039Hthinking&nbsp;1[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-1[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-2[003;000Heven&nbsp;numbers:&nbsp;15000-0[005;032H&nbsp;eating&nbsp;&nbsp;0[010;044Hthinking&nbsp;0[003;000Heven&nbsp;numbers:&nbsp;15000-5[016;039H&nbsp;eating&nbsp;&nbsp;5[016;024Hthinking&nbsp;4[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-0[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-4[003;000Heven&nbsp;numbers:&nbsp;15000-2[010;020H&nbsp;eating&nbsp;&nbsp;2[005;032Hthinking&nbsp;2[003;000Heven&nbsp;numbers:&nbsp;15000-5[010;044H&nbsp;eating&nbsp;&nbsp;5[016;039Hthinking&nbsp;5[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-2[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-5[003;000Heven&nbsp;numbers:&nbsp;15000-3[016;024H&nbsp;eating&nbsp;&nbsp;3[010;020Hthinking&nbsp;6[003;000Heven&nbsp;numbers:&nbsp;15000-0[005;032H&nbsp;eating&nbsp;&nbsp;0[010;044Hthinking&nbsp;0[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-6[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-0[003;000Heven&nbsp;numbers:&nbsp;15000-3[016;039H&nbsp;eating&nbsp;&nbsp;3[016;024Hthinking&nbsp;6[003;000Heven&nbsp;numbers:&nbsp;15000-1[010;020H&nbsp;eating&nbsp;&nbsp;1[005;032Hthinking&nbsp;4[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-6[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-4[003;000Heven&nbsp;numbers:&nbsp;15000-3[010;044H&nbsp;eating&nbsp;&nbsp;3[016;039H&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;4[003;000Heven&nbsp;numbers:&nbsp;15000-1[016;024H&nbsp;eating&nbsp;&nbsp;1[010;020Hthinking&nbsp;6[003;000H&nbsp;odd&nbsp;numbers:&nbsp;10000-6[003;000Heven&nbsp;numbers:&nbsp;15000-3[005;032H&nbsp;eating&nbsp;&nbsp;3[010;044H&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;5[003;000Heven&nbsp;numbers:&nbsp;15000-1[016;024H&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;1[003;000Heven&nbsp;numbers:&nbsp;15000-3[010;020H&nbsp;eating&nbsp;&nbsp;3[005;032H&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;6[020;000HPhilosopher&nbsp;0&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[021;000HPhilosopher&nbsp;1&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[022;000HPhilosopher&nbsp;2&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[023;000HPhilosopher&nbsp;3&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[003;000Heven&nbsp;numbers:&nbsp;15000-3[010;020H&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;3[024;000HPhilosopher&nbsp;4&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>The&nbsp;end!</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>The&nbsp;last&nbsp;thread&nbsp;has&nbsp;exited!</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Rebooting&nbsp;the&nbsp;machine&nbsp;...</span></span></span></div></pre><p>Aqui está a captura do estado final de uma execução:</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>The&nbsp;Philosopher&#39;s&nbsp;Dinner:</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Philosophers&nbsp;are&nbsp;alive&nbsp;and&nbsp;hungry!</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>even&nbsp;numbers:&nbsp;15000-3</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>done&nbsp;&nbsp;&nbsp;6</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>done&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;5</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>done&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;4</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>The&nbsp;dinner&nbsp;is&nbsp;served&nbsp;...</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Philosopher&nbsp;0&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Philosopher&nbsp;1&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Philosopher&nbsp;2&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Philosopher&nbsp;3&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Philosopher&nbsp;4&nbsp;ate&nbsp;4&nbsp;times</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>The&nbsp;end!</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>The&nbsp;last&nbsp;thread&nbsp;has&nbsp;exited!</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Rebooting&nbsp;the&nbsp;machine&nbsp;...</span></span></span></div></pre></body>
</html>
